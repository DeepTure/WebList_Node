<!DOCTYPE html>
<html>
    <head>    
        <title>
            WebList
        </title>
        <link rel="shortcut icon" href="/public/Img/DeepTureL.ico" />
        <meta charset="utf-8">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <link rel="stylesheet" type="text/css" media="screen and (prefers-color-scheme: no-preference)" href="/public/CSS/RespL.css">
        <link rel="stylesheet" type="text/css" media="screen and (prefers-color-scheme: no-preference)" href="/public/CSS/FuenteL.css">

        <link rel="stylesheet" type="text/css" media="screen and (prefers-color-scheme: dark)" href="/public/CSS/RespD.css">
        <link rel="stylesheet" type="text/css" media="screen and (prefers-color-scheme: light)" href="/public/CSS/RespL.css">

        <link rel="stylesheet" type="text/css" media="screen and (prefers-color-scheme: dark)" href="/public/CSS/FuenteD.css">
        <link rel="stylesheet" type="text/css" media="screen and (prefers-color-scheme: light)" href="/public/CSS/FuenteL.css">

        <style type="text/css">
            .bg-img{
                margin: 0;
                background-image: url('/public/Img/BackgroundD.png');
                background-size: 100%;
                background-repeat: no-repeat;
                background-position: 0 0;
                background-attachment: fixed;
                background-size: cover;
                transition: background 1s;
            }
            .fg-img{
                background-image: url('/public/Img/ForegroundD.png');
                background-size: 100%;
                background-repeat: no-repeat;
                background-position: 0 0;
                background-attachment: fixed;
                background-size: cover;
                transition: background 1s;
            }

            .logo{
                background-image: url('/public/Img/DeepTureD.png');
                background-size: 100%;
                background-size: cover;
                transition: background 1s;
            }

            .logoHelp{
                background-image: url('/public/Img/HelpL.png');
                background-size: 70%;
                background-repeat: no-repeat;
                background-position: 50% 0;
                transition: background 1s;
            }

            @media screen and (prefers-color-scheme: light) {
                .bg-img{
                    background-image: url('/public/Img/BackgroundL.png');
                    transition: background 1s;
                }
                .fg-img{
                    background-image: url('/public/Img/ForegroundLHelp.png');
                    transition: background 1s;
                }
                @media screen and (orientation: landscape){
                    .fg-img{
                        background-image: url('/public/Img/ForegroundL.png');
                        transition: background 1s;
                    }
                }
                .logo{
                    background-image: url('/public/Img/DeepTureL.png');
                    transition: background 1s;
                }
                .logoHelp{
                    background-image: url('/public/Img/HelpD.png');
                    transition: background 1s;
                }
            }
        </style>
    </head>
    <body link="Black" vlink="Black" alink="Black" class="bg-img">

        <nav>
            <p class="title">
                Bienvenido
            </p>
            <p class="space">
                <br>
                <br>
                <br>
            </p>
            <p class="subtitle">
                Mis grupos
            </p>
            <p class="space">
                <br>
                <br>
                <br>
            </p>
            <div class="atxt">
                <form action="CRUDalumno" method="post">
                    <input type="hidden" name="idpr" value="">
                    <input type="hidden" name="instruction" value="4IV7">
                    <input type="button" class="inputbutn int nav" name="" onclick="getAlumnos('5IV7')" value="5IV7">
                </form>

                <p class="space">
                    <br>
                </p>

                <form action="CRUDalumno" method="post">
                    <input type="hidden" name="idpr" value="">
                    <input type="hidden" name="instruction" value="4IV8">
                    <input type="button" class="inputbutn int nav" name="" onclick="getAlumnos('5IV6')" value="5IV6">
                </form>

                <p class="space">
                    <br>
                </p>

                <form action="CRUDalumno" method="post">
                    <input type="hidden" name="idpr" value="">
                    <input type="hidden" name="instruction" value="5IV9">
                    <input type="button" class="inputbutn int nav" name="" onclick="getAlumnos('5IV9')" value="5IV9">
                </form>
            </div>

            <!-- botones para salir de tu cuenta y para configurara tu cuenta-->
            <div class="padd">
                <input type="button" name="Perfil" value="Perfil" onclick="location.href = 'MyProfile.jsp'" class="inputbutn nav int ">
                <p class="space">
                    <br>
                </p>
                <input type="button" name="LogOut" value="Cerrar sesión" onclick="location.href = 'index.jsp'" class="inputbutn nav int">
            </div>

        </nav>

        <div class="blockAn fg-img">
            <p class="space">
                <br>
                <br>
                <!--No quitar el br dinamico-->
            </p>

            <form action="CRUDalumno" method="post">
                <div class="pdf">
                    <p class="title white">
                        Horario del grupo
                    </p>
                    <div id="pdf">
                        <embed id="pdfs" src="/public/Img/tec-Programacion-escolarizado.pdf" type="application/pdf" style="height: 35vw; width: 80%;"/>
                    </div>
                </div>
                <p class="space">
                    <br>
                    <br>
                </p>

                <div name="lista">
                    <p class="atxt white">
                        Materia<br>
                        <input type="radio" style="width: 5%; height: 1vw;" name="rd" id="mat1" onclick="prepararIdMateria('SWyA')">
                        <label for="mat1" class="atxt white">Seguridad web y aplicaciones</label><br>
                        <input type="radio" style="width: 5%; height: 1vw;" name="rd" id="mat2" onclick="prepararIdMateria('ISD')">
                        <label for="mat2" class="atxt white">Introducción a los sustemas distribuidos</label><br>
                        <input type="radio" style="width: 5%; height: 1vw;" name="rd" id="mat3" onclick="prepararIdMateria('IIDP')">
                        <label for="mat3" class="atxt white">Ingeniería de pruebas</label><br>
                        <input type="radio" style="width: 5%; height: 1vw;" name="rd" id="mat4" onclick="prepararIdMateria('LPTIIII')">
                        <label for="mat" class="atxt white">Laboratorio de proyectos de tecnologias de la informacion</label>
                    </p>
                    <p class="space">
                        <br><br>
                    </p>
                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#mat1').click(function () {
                                document.getElementById('command').value = 'PSW';
                                document.getElementById('command2').value = 'PSW';
                            });
                            $('#mat2').click(function () {
                                document.getElementById('command').value = 'TPPC';
                                document.getElementById('command2').value = 'TPPC';
                            });
                            $('#mat3').click(function () {
                                document.getElementById('command').value = 'BBDD';
                                document.getElementById('command2').value = 'BBDD';
                            });
                            $('#mat4').click(function () {
                                document.getElementById('command').value = 'LPTI';
                                document.getElementById('command2').value = 'LPTI';
                            });
                        });
                    </script>
                </div>
                <!--botones para borrar o configurar las listas
                Tabla que muestra las faltas
                -->
                <div>
                    <p class="atxt white">
                        Lista actual: 
                    </p>

                    <div>
                        <table id="alumnosDeGrupo">
                            <tr>
                                <td class="atxt white">
                                    Boleta
                                </td>
                                <td class="atxt white">    
                                    Nombre
                                </td>
                                <td class="atxt white">
                                    Asistencia
                                </td>
                            </tr>

                                <tr>
                                    <td class="atxt white">
                                        Boleta
                                    </td>
                                    <td class="atxt white">
                                        Nombre
                                    </td>
                                    <td>
                                        <input type="checkbox" style="width: 5%; height: 1vw;" name="asistencia" value="">
                                    </td>
                                </tr>

                            <tr>
                                <td class="atxt white">
                                    215
                                </td>
                                <td class="atxt white">
                                    juan
                                </td>
                                <td>
                                    <input type="checkbox" style="width: 5%; height: 1vw;">
                                </td>
                            </tr>

                        </table>


                        <p class="space">
                            <br>
                        </p>

                        <input type="button" name="save" value="Guardar" id="btn" class="inputbutn int white" onclick="registrarInasistencia()">
                        <p class="space">
                            <br>
                        </p>
                        </form>

                        <form action="CRUDalumno" method="post">
                            <input type="hidden" name="gr" value="">
                            <input type="hidden" name="idpr" value="">
                            <input type="hidden" name="materia" id="command2" value="null">
                            <input type="hidden" name="instruction" value="getFalt">
                            <input type="submit" name="delete" value="Revisar ultimo registro" id="btn" class="inputbutn int white">
                        </form>
                    </div>

                    <p class="atxt white">
                        No hay faltas actualmente.
                    </p>

                    <p class="atxt white">
                        Faltas del dia de hoy.
                    </p>
                    <table>
                        <tr>
                            <td class="atxt white">
                                Boleta
                            </td>
                            <td class="atxt white">
                                Nombre
                            </td>
                            <td class="atxt white">
                                Accion
                            </td>
                        </tr>

                        <tr>
                        <form action="CRUDalumno" method="post">
                            <input type="hidden" name="gr" value="">
                            <input type="hidden" name="idpr" value="">
                            <input type="hidden" name="materia" value="">
                            <input type="hidden" name="boleta" value="">
                            <input type="hidden" name="dia" value="">
                            <input type="hidden" name="instruction" value="eliminarFal">
                            <td>
                                Boleta</td><td>Nombre Apellidos
                            </td>
                            <td>
                                <input type="submit" name="" value="Borrar" id="btn" class="inputbutn int white">
                            </td>
                        </form>
                        </tr>

                    </table>
                    <br>
                    <p class="atxt white">
                        Insertar nueva falta.
                    </p>
                    <form action="CRUDalumno" method="post">
                        <input type="hidden" name="gr" value="">
                        <input type="hidden" name="idpr" value="">
                        <input type="hidden" name="materia" value="">
                        <input type="hidden" name="dia" value="">
                        <label for="bol">Numero de Boleta</label>
                        <input type="text" id="bol" name="boleta" class="inputtxt white"/>
                        <input type="hidden" name="instruction" value="añadirFal">
                        <br>
                        <input type="submit" name="" value="Guardar" id="btn" class="inputbutn int white"/>
                    </form>

                    <p class="space">
                        <br>
                    </p>
                </div>
        </div>

        <script type="text/javascript">
            //extraer los grupos
            function getAlumnos(grupo){
                $.ajax({
                    url:'/getAlumnosGrupo',
                    type:'post',
                    data:{grupoS:grupo},
                    success: function(response){
                        console.log(response)
                        mostrarAlumnos(response);
                    },
                    error:function(response){
                        alert(response);
                        console.log(response)
                    }
                });
            }

            //para mostrar en la tabla los grupos //alumnosDeGrupo
            function mostrarAlumnos(alumnos){
                let codigo = "";
                codigo = `<tr>
                                <td class="atxt white">
                                    Boleta
                                </td>
                                <td class="atxt white">    
                                    Nombre
                                </td>
                                <td class="atxt white">
                                    Asistencia
                                </td>
                            </tr>`
                for(var i=0; i<alumnos.length; i++){
                    codigo += `
                    <tr>
                        <td class="atxt white">
                           `+alumnos[i].bol+` 
                        </td>   
                        <td class="atxt white">
                           `+alumnos[i].name+' '+alumnos[i].lastName+` 
                        </td>  
                        <td class="atxt white">
                            <input type="checkbox" style="width: 5%; height: 1vw;" name="asistencia" onclick="prepararBoletas(`+alumnos[i].bol+`)" name="`+alumnos[i].bol+`">
                        </td>   
                    </tr>
                    `
                }
                $('#alumnosDeGrupo').html(codigo);
            }

            //esta funcion se encarga de preparar las boletas, cada vez que hace click en un alumno para registrar su inasistencia, entonces se carga en esta funcion y se prepara 
            //para cuando el profesor presione en guardar
            let boletasDeInasistencia = [];
            function prepararBoletas(boleta){
                boletasDeInasistencia.push(boleta);
            }

            //esta funcion se encarga de almacenar la materia del profesor
            let materiaDeLaInasistencia = [];
            function prepararIdMateria(materia){
                materiaDeLaInasistencia[0] = materia;
            }

            //para guardar la inasistencia usamos esta petición
            function registrarInasistencia(){
                var sendBoletas = JSON.stringify(boletasDeInasistencia);
                var sendMaterias = JSON.stringify(materiaDeLaInasistencia);
                $.ajax({
                    url:'/saveInasistencia',
                    type:'post',
                    data:{boletas: sendBoletas, numEmpleado:'526', idMateria:sendMaterias},
                    success: function(response){
                        console.log(response)
                        alert(response);
                    },
                    error:function(response){
                        alert(response);
                        console.log(response)
                    }
                });
            }
        </script>

    </body>
</html>
